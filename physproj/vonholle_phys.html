<!DOCTYPE html>

<!-- code borrows heavily from the following:
	 http://nokarma.org/2011/02/27/javascript-game-development-keyboard-input/ 
	 http://www.w3schools.com/graphics/game_intro.asp 							-->

<html>
<head>
    <style type="text/css" media="screen">
        body{
            background: #26353f;
        }
        canvas{
            border: 3px solid;
            border-color: cyan;
            postion: relative;
        }
    </style>	
	<script type="text/javascript" charset="utf-8">
  
		    var Key = {
		      _pressed: {},
		
		      LEFT: 37,
		      UP: 38,
		      RIGHT: 39,
		      DOWN: 40,
		
		      isDown: function(keyCode) {
		        return this._pressed[keyCode];
		      },
		
		      onKeydown: function(event) {
		        this._pressed[event.keyCode] = true;
		      },
		
		      onKeyup: function(event) {
		        delete this._pressed[event.keyCode];
		      }
		    };
		        
		    window.addEventListener('keyup',   function(event) { Key.onKeyup(event);   }, false);
		    window.addEventListener('keydown', function(event) { Key.onKeydown(event); }, false);
    
    		    
		    var MAX_W = 640;
		    var MAX_H = 480;
		    
		    var numberOfExamples = 2;
		    
		    var Board = {
		    	fps: 60,
		    	width:  MAX_W,
		    	height: MAX_H
		    };
		    
		    
		    Board._onEachFrame = (function() {
		    	var requestAnimFrame = window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;
		    	
		    	if(requestAnimFrame) {
		    		return function(cb) {
		    			var _cb = function() { cb(); requestAnimFrame(_cb); }
		    			_cb();
		    		};
		    	}else{
		    		return function(cb) {
		    			setInterval(cb, 1000 / Board.fps);
		    		}
		    	}
		    })();
		    
		    /* Board.start
		       takes a number
		       starts the corresponding example */
		    Board.start = function(exNum) {
		    	Board.canvas = document.createElement("canvas");
		    	
		    	document.getElementById("debug").innerhtml("canvas created");
		    	
		    	Board.canvas.width  = Board.width;
		    	Board.canvas.height = Board.height;
		    	
		    	Board.context = Board.canvas.getContext("2d");
		    	
		    	document.body.appendChild(Board.canvas);
		    	
		    	if (exNum == 0) {
		    		Board.player = new Player(MAX_W/2,MAX_H/2, 32,32, 1, 3, 100, "yellow", "color");
		    		Board.platform = [];
		    		Board.platform.push(new Player(400,MAX_H/2, 200,10, 0, 0, 0, "purple", "color"));
		    	} else if (exNum == 1) {
		    		Board.player = new Player(MAX_W/2,MAX_H/2, 32,32, 1, 3, 100, "blue", "color");
		    	} else {
		    		Board.player = new Player(MAX_W/2,MAX_H/2, 32,32, 1, 3, 100, "orange", "color");
		    	}
		    	
		    	Board._onEachFrame(Board.run);
		    	
		    	
				for ( i = 0; i < numberOfExamples; ++i){
					if(i == exNum) {
				    	document.getElementById("ex" + exNum).style.display = "none";
				    	document.getElementById("ex" + exNum + "_h").style.display = "block";
				    } else {
				    	document.getElementById("ex" + i).style.display = "none";
				    }
			    }
		    };
		    
		    /* Board.end
		       takes a number
		       ends the corresponding example */
		    Board.end = function(exNum) {
		    	document.body.removeChild(this.canvas);
		    	
		    	for ( i = 0; i < numberOfExamples; ++i){
					if(i == exNum) {
				    	document.getElementById("ex" + exNum).style.display = "block";
				    	document.getElementById("ex" + exNum + "_h").style.display = "none";
				    } else {
				    	document.getElementById("ex" + i).style.display = "block";
				    }
			    }		  
			 };
		   
		   /* Board.run
		      runs the game loop  */
		   Board.run = (function() {
		    	var loops = 0, skipTicks = 1000 / Board.fps,
		    		maxFrameSkip = 10,
		    		nextGameTick = (new Date).getTime(),
		    		lastGameTick;
		    		
		    	return function() {
		    		loops = 0;
		    		
		    		while ((new Date).getTime() > nextGameTick) {
		    			Board.update();
		    			nextGameTick += skipTicks;
		    			loops++;
		    		}
		    		
		    		if (loops) Board.draw();
		    	}
		    })();
		    
		    /* Board.draw
		       takes nothing
		       creates an empty rectangle for to canvas the example on */
		    Board.draw = function() {
		    	Board.context.clearRect(0,0, Board.width, Board.height);
		    	Board.player.draw(Board.context);
		    	for(i =0; i < Board.platform.length; ++i){
		    		Board.platform[i].draw(Board.context);
		    	}
		    }
		    
		    Board.update = function() {
		    	Board.player.update();
		    };
		    
		    function Player(x,y, w,h, speed, grav, jump, color, type) {
		   		this.type = type;
		    	if(type == "image") {
		    		this.image = new Image();
		    		this.image.src = color;
		    	} else {
		    		this.color = color;
		    	}
		    	this.x = x;
		    	this.y = y;
		    	
		    	this.width = w;
		    	this.height = h;
		    	
		    	this.speed = speed;
		    	this.g = grav;
		    	this.jump_h = jump;
		    }
		    
		    Player.prototype.draw = function(context) {
		    	if (this.type == "image") {
		    		context.drawImage(this.image, this.x, this.y, this.width, this.height);
		    	} else {
		    		context.fillStyle = this.color;
		    		context.fillRect(this.x, this.y, this.width, this.height);
		    	}
		    };
		    
		    Player.prototype.moveLeft = function () {
		    	if (this.x > 0) {
		    		this.x -= this.speed;
		    	}
		    };
		    
		    Player.prototype.moveRight = function() {
		    	if (this.x <= (MAX_W - 32)) {
		    		this.x += this.speed;
		    	}
		    };
		    
		    Player.prototype.jump = function() {
		    	this.y -= this.jump_h;
		    	this.jump_cooldown = true;
		    };
		    
		    Player.prototype.fall = function() {
		   		this.y += this.g;
		    	this.jump_cooldown = false;		
	        };
		    
		    /*Player.prototype.checkCollision = function(crashee) {
		    	return ((this.y + this.height) < crashee.y || (this.y) > (crashee.y + crashee.height) ||
		    			(this.x + this.width)  < crashee.x || (this.x) > (crashee.x + crashee.width));
		    };*/
		    
		    Player.prototype.update = function() {
		    	if (Key.isDown(Key.UP) && this.jump_cooldown == false) this.jump();
		    	if (Key.isDown(Key.LEFT))                              this.moveLeft();
		    	if (Key.isDown(Key.RIGHT)) 		                       this.moveRight();
		    	if (this.y <= (MAX_H - 32))                            this.fall();
	       };	
	
    </script>
</head>

<!-- ************ -->
<!-- * END HEAD * -->
<!-- ************ -->

<body>
	<p id="debug"></p>
	<h1> STUFF GOES HERE, </h1>
	<p> here, <br/br>
  	    here, and here. </p>
	<button id="ex0" onclick="Board.start(0)">click to start example one</button>
	<button id="ex0_h" onclick="Board.end(0)" style ="display: none">click to end example one</button>
	<h2> Probably some more goes down here too. </h2>
	<p> I'm not sure, <br/br> 
	    but probably. </p>
	<button id="ex1" onclick="Board.start(1)">click to start example two</button>
	<button id="ex1_h" onclick="Board.end(1)" style ="display: none">click to end example two</button>
</body>

<!-- ************ -->
<!-- * END BODY * -->
<!-- ************ -->

</html>
